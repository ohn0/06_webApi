<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <style>
            #mechaTable{
                border: 1px solid black;
            }
            
            th, td {
                border: 1px solid black;
            }
            
            div{
                margin: auto;
                width: 70%;
            }
        </style>
        <title>mechaDB</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script language="Javascript" type="text/javascript">
            "use strict";
            var httpReq;
            if(window.XMLHttpRequest){
                httpReq = new XMLHttpRequest();
            } else if(window.ActiveXObject){
                httpReq = new ActiveXObject("Microsoft.XMLHTTP");
            } else {alert("AJAX not supported.");}
            function my$(element){
                return document.getElementById(element);
            }
            
            function LOG(text){
                console.log(text);
            }
            
            function sendRequest() {
                var url = "mechaInfo.jsp";
                var sortType = my$("sortOptions").options[my$("sortOptions").
                        selectedIndex].value;
                LOG(sortType);
                url += "?q=" + my$("nameBox").value + "_?s=" + sortType;
                httpReq.open("GET", url);
                httpReq.onreadystatechange = handleResponse;
                httpReq.send(null);
                handleResponse();
            }
            
            function handleResponse(){
                var imageTable = my$("mechaTable");
                if(httpReq.readyState === 4 && httpReq.status === 200){
                    LOG("ready");
                    var outputText = "";
                    var response = httpReq.responseText;
                    response = "("+response+")";
                    var obj = eval(response);
                    if(obj === null){console.log("Null value returned.");}
                    if(obj.dbError === null){console.log("JSON string had no db property.");}
                    if(obj.dbError.length > 0){console.log(obj.dbError);}
                    if(obj.recordList === null){console.log("Recordlist DNE.");}
                    if(obj.recordList.length === 0){
                        outputText = "Nothing mathched your query.";
                    }else{
                        for(var i = 0; i < obj.recordList.length; i++){
                            var mechaRow = document.createElement("tr");
                            var mechaName = document.createElement("td");
                            var mechaIMG = document.createElement("td");
                            var mechaIMGContainer = document.createElement("img");
                            mechaIMGContainer.src = obj.recordList[i].mechaURL;
                            mechaRow.appendChild(mechaName);
                            mechaIMG.appendChild(mechaIMGContainer);
                            mechaRow.appendChild(mechaIMG);
                            imageTable.appendChild(mechaRow);
                            mechaIMGContainer.style.width = "250px";
                            mechaIMGContainer.style.height = "50%";

                            mechaName.innerHTML = obj.recordList[i].mechaDescriptor;
                        }
                    }
                    my$("data").innerHTML = outputText;
                }
            }
        </script>
    </head>
    <body>
        <input type="text" id="nameBox" value="" size="30" />
        <input type="button" value="Search mecha name" onClick="javascript:sendRequest()"/><br/>
        <span>Choose sort type:</span>
        <select id="sortOptions">
            <option value="mechaDescriptor">mechaDescriptor</option>
            <option value="mechaName">      mechaName</option>
            <option value="mechaHeight">    mechaHeight</option>
            <option value="mechaTable_ID">  mechaTable_ID</option>
        </select>
        <div id="data"></div>
        <table id="mechaTable">
        </table>
    </body>
</html>
