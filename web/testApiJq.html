<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <link rel="stylesheet" type="text/css" href="apiCSS.css">
        <title>mechaDB jQ</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
        <script language="Javascript" type="text/javascript">
            function LOG(text){
                console.log(text);
            }
            
            function buildTableString(mRecord){
                return "<td>"+mRecord.mechaName+"</td>"+
                       "<td>"+mRecord.mechaDescriptor+"</td>"+
                       "<td>"+mRecord.mechaTable_ID+"</td>"+
                       "<td>"+mRecord.mechaHeight+"</td>"+
                       "<td><img src="+mRecord.mechaURL+"></img></td>";
            }
            $(document).ready(function()
            {
                $('#getButton').click(function(){
                    $("#data > table > tr").empty();
                    var url = "mechaInfo.jsp";
                    url += "?q=" + $("#nameBox").val();
                    LOG(url);
                    ajaxSuccess = function (response){
                        LOG("Success");
                        var obj = eval(response);
                        var tableString = "<table>";
                        if(obj.recordList.length === 0){
                            tableString = "Your query did not match any names.";
                        }
                        else{
                            tableString +="<th>Mecha Name</th>"+
                                          "<th>Mecha Descriptor</th>"+
                                          "<th>Mecha Table ID</th>"+
                                          "<th>Mecha Height</th>"+
                                          "<th>Mecha Image</th>";
                            for(var i = 0; i < obj.recordList.length; i++){
                                LOG(obj.recordList[i]);
                                tableString += "<tr>"+buildTableString(obj.recordList[i])+"</tr>";
                            }
                            tableString += "</table>";
                            LOG("Table tag:" + tableString);
                        }
                        $("#data").append(tableString);                            
                    };
                    
                    ajaxFailure = function(jqXHR, textStatus){
                        alert("Problem encountered: " + textStatus);
                    };
                    $.ajax(
                        {
                            type:"GET",
                            cache: false,
                            url: url,
                            dataType: "json",
                            timeout: 5000,
                            success: ajaxSuccess,
                            error: ajaxFailure
                        });
                });
            });

        </script>
    </head>
    <body>
        <div id="inputDIV">Enter mecha name to start searching:
        <input type="text" id="nameBox" value="" size="30" />
        <input type="button" value="Search mecha name" id="getButton"/><br/>
        </div>
        <div id="data"></div>
    </body>
</html>
